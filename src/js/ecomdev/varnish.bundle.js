window.VarnishBundle=function(e){var t={};function o(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(s,n,function(t){return e[t]}.bind(null,n));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);function s(e){console&&console.warn&&console.warn(e)}function n(e,t){const o=document.getElementById(e);if(!o)return;o.innerHTML="";const s=document.createRange();s.selectNode(o),o.appendChild(s.createContextualFragment(t))}class i{constructor(e,t,o){this.blockId=e,this.container=t,this.storage=o}process(e){if(!this.storage.isIgnored())return this.storage.cachedValue(()=>e(this.blockId)).then(e=>{n(this.container,e)})}}function r(){return document.cookie.split(/; ?/).reduce((e,t)=>{if(-1===t.indexOf("="))return e;const[o,s]=t.split("=");return e[decodeURIComponent(o)]=decodeURIComponent(s),e},{})}function c(e,t,o){o=o||{},document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+(o.expires?"; Expires="+o.expires.toUTCString():"")+(o.path?"; Path="+o.path:"")+(o.domain?"; Domain="+o.domain:"")}function a(e){const t=r();return t[e]?t[e]:void 0}class l{constructor(){this.data={}}getItem(e){return void 0!==this.data[e]?this.data[e]:null}setItem(e,t){this.data[e]=t}}const u=window.localStorage?window.localStorage:window.sessionStorage?window.sessionStorage:(window.fallbackStorage||(window.fallbackStorage=new l),window.fallbackStorage);function h(e){return"cache-storage-"+e}function d(e){return"meta-"+h(e)}class p{constructor(e,t,o,s){this.cacheId=e,this.requiredCookie=t,this.additionalCookies=o||[],this.ttl=s||1200,this.currentFetchResult=void 0}isIgnored(){return!a(this.requiredCookie)}cachedValue(e){let t=(o=this.cacheId,u.getItem(h(o)));var o;return t&&function(e){const t=JSON.parse(u.getItem(d(e)));if("object"!=typeof t)return!1;if(a(t.cookieName)!==t.cookieValue)return!1;for(let e in t.additionalCookies)if(t.additionalCookies[e]!==a(e))return!1;return!(Date.parse(t.expires)<Date.now())}(this.cacheId)?Promise.resolve(t):this._processUncachedData(e)}_processUncachedData(e){if(this.currentFetchResult)return this.currentFetchResult;const t=e().then(e=>{var t,o,s,n;return function(e,t){u.setItem(h(e),t)}(this.cacheId,e),t=this.cacheId,o=this.requiredCookie,s=this.additionalCookies,n=this.ttl,u.setItem(d(t),JSON.stringify({cookieName:o,expires:new Date(Date.now()+1e3*n).toUTCString(),additionalCookies:s.reduce((e,t)=>{const o=a(t);return e[t]=o||"",e},{}),cookieValue:a(o)})),this.currentFetchResult=void 0,e},()=>"");return this.currentFetchResult=t,t}_generateMetadata(){return{cookie:a(this.requiredCookie)}}}function f(e,t,o){return e.replace(new RegExp("(/"+(t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"/)[^/]+"),"g"),"$1"+o)}function m(e,t,o){for(let s of document.querySelectorAll(e)){let e=s.getAttribute("href");e&&s.setAttribute("href",f(e,t,o))}}class g{constructor(e,t,o,s){this.container=e,this.messageTypes=t,this.fetchFunction=s,this.matchHashMap=t.reduce((e,t)=>(e[t]=!0,e),{}),this.url=o}claimTypes(e){return this.messageTypes.reduce(([e,t],o)=>{const s=t.indexOf(o);return-1!==s&&(e.push(o),t.splice(s,1)),[e,t]},[[],e])}loadMessages(e){const t=new FormData;return t.append("storage",e.join(",")),this.fetchFunction(new Request(this.url,{method:"POST",body:t})).then(e=>e.text()).then(e=>{n(this.container,e)})}}t.default=function(){const e=new class{constructor(e){this.elementTypes={},this.scriptType=e}elementType(e,t){this.elementTypes[e]=t}processDocument(){const e=document.getElementsByTagName("script");for(let t=0;t<e.length;t++){let o=e[t];if(o.getAttribute("type")===this.scriptType&&o.dataset.type&&this.elementTypes[o.dataset.type]&&!o.pageIsProcessed){o.pageIsProcessed=!0;try{let e=JSON.parse(o.innerHTML);this.elementTypes[o.dataset.type](e)}catch(e){s(e),s(o.innerHTML)}}}}}("ecomdev/varnish-element"),t=new class{constructor(e,t){this.blocks={},this.storageClass=e,this.fetch=t,this.loadUrl=!1}registerBlock(e){Array.isArray(e.additionalCookies)||(e.additionalCookies=[]),this.blocks[e.block]=new i(e.block,e.container,new this.storageClass(e.block,e.cookie,e.additionalCookies))}registerLoader(e){this.loadUrl=e.url}processBlocks(){if(!this.loadUrl)return Promise.resolve(0);const e={},t=[],o=[];for(let s in this.blocks)o.push(this.blocks[s].process(o=>(t.push(o),new Promise((t,s)=>{e[o]=[t,s]}))));if(!t.length)return Promise.all(o).then(()=>t.length);const s=new FormData;s.set("blocks",t.join(","));const n=this.fetch(new Request(this.loadUrl,{method:"POST",body:s})).then(e=>200===e.status?e.json():{}).then(t=>{for(let o in e)t[o]?e[o][0](t[o]):e[o][1](t[o])});return o.push(n),Promise.all(o).then(()=>t.length)}}(p,fetch.bind(window)),o=new class{constructor(){this.cookieName="",this.cookieOptions={},this.linkCssSelectors=[],this.inputName="",this.urlKeyParam="",this.variableExports=[]}formKey(){if(!this.cookieName)return"";const e=a(this.cookieName)||[...Array(16)].map((function(){return Math.floor(36*Math.random()).toString(36)})).join("");return c(this.cookieName,e,this.cookieOptions),e}processConfig(e){this.cookieName=e.cookieName,this.cookieOptions=e.cookieOptions,this.inputName=e.inputFieldName,this.urlKeyParam=e.urlKeyParam,Array.isArray(e.observedCssRules)&&(this.linkCssSelectors=e.observedCssRules),e.locationFunction&&e.urlKeyParam&&function(e,t,o){const s=window[e];window[e]=function(){const e=[...arguments],n=f(e.shift(),t,o());return e.unshift(n),s.apply(window,e)}}(e.locationFunction,e.urlKeyParam,()=>this.formKey())}processExport(e){this.variableExports.push(e.variableName)}replaceValues(){const e=this.formKey();this.inputName&&function(e,t){for(let o of document.getElementsByName(e))o.value=t}(this.inputName,e);const t=this.urlKeyParam;if(t)for(let o of document.querySelectorAll('form[action*="'+t+'"]'))o.action=f(o.action,t,e);if(this.linkCssSelectors.length)for(let o of this.linkCssSelectors)m(o,t,e);for(let t of this.variableExports)window[t]=e}},n=new class{constructor(e){this.fetchFunction=e,this.loaders=[],this.cookieName="",this.cookieOptions={}}registerLoader(e){this.loaders.push(new g(e.container,e.types,e.url,this.fetchFunction)),e.cookieName&&(this.cookieName=e.cookieName),"object"==typeof e.cookieOptions&&(this.cookieOptions=e.cookieOptions)}processMessages(){if(!a(this.cookieName))return Promise.resolve(0);const e=a(this.cookieName).split(",").reduce((e,t)=>((t=t.trim()).length&&e.push(t),e),[]),t=[],o=this.loaders.reduce((e,o)=>{const[s,n]=o.claimTypes(e);return s.length&&t.push([o,s]),n},e),s=new Date;return s.setHours(s.getHours()+2),c(this.cookieName,o.join(","),Object.assign({},this.cookieOptions,{expires:s})),Promise.all(t.map(([e,t])=>e.loadMessages(t))).then(e=>e.length).catch(()=>0)}}(fetch.bind(window)),r={};function l(){t.processBlocks().then(()=>(o.replaceValues(),n.processMessages()))}var u;return e.elementType("block",t.registerBlock.bind(t)),e.elementType("block-loader",t.registerLoader.bind(t)),e.elementType("messages",n.registerLoader.bind(n)),e.elementType("form-key",o.processConfig.bind(o)),e.elementType("form-key-export",o.processExport.bind(o)),e.elementType("page-info",e=>{Object.assign(r,e)}),u=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(e){this.addEventListener("readystatechange",(function(){this.responseText.length>0&&4===this.readyState&&setTimeout(l,50)}),!1),u.apply(this,arguments)},document.addEventListener("DOMContentLoaded",(function(){e.processDocument(),l()})),{CacheStorage:p,Page:e,DynamicBlock:t,FormKey:o,Messages:n,PageInfo:r,update:l}}()}]).default;